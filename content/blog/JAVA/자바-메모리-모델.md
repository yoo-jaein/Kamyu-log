---
title: 자바 메모리 모델
date: 2020-08-10 14:08:30
category: java
draft: false
---

## 들어가기
자바 메모리 모델은 자바 개발자가 되려면 필수적으로 이해하고 있어야 하는 영역이다. 이번 글에서 자바 메모리 모델이 무엇인지, 어떤 부분으로 나누어져 있는지에 대해 공부한다. 마지막으로 가비지 컬렉션의 개념에 대해 간략하게 정리한다.

- 목차
	- [들어가기](#들어가기) 
    - [자바 메모리 모델](#자바-메모리-모델) 
    - [메소드 영역](#메소드-영역)
    - [스택 영역](#스택-영역) 
    - [힙 영역](#힙-영역) 
    - [가비지 컬렉션](#가비지-컬렉션) 
    - [마무리](#마무리) 

## 자바 메모리 모델

- 자바 프로그램은 자바 가상 머신(JVM) 위에서 동작한다. 이 JVM 또한 하나의 프로그램이기 때문에 운영체제 위에서 동작한다. 

- __JVM은 자바 프로그램이 실행되면 `운영체제`로부터 해당 프로그램이 필요로 하는 `메모리를 할당`받고, 그 메모리를 용도에 따라 `여러 영역`으로 나누어 관리한다.__

- 이렇게 나누어진 자바 메모리 모델을 `Runtime Data Area`라고도 부른다.

- 이 글에서는 Runtime data area 중 3개의 영역(메소드 영역, 스택 영역, 힙 영역)에 대해 정리한다.

## 메소드 영역

- __`메소드 영역`(Method area)은 `클래스의 바이트코드`(bytecode)와 `static 변수`가 저장되는 공간이다.__  
</br>

- 클래스 내부 정보와 오브젝트/인터페이스 초기화를 위한 요소들을 저장한다.  
</br>

- _필드 정보, 메소드 정보, Type, constant pool, static 변수, final class 변수, main 메소드가 실행되기 전 import된 패키지와 java.lang 패키지_가 저장된다.

## 스택 영역

- __`스택 영역`(Stack area)은 `지역 변수`(local variable)와 `매개 변수`(parameter)가 저장되는 공간이다.__  
</br>

- 이 두 변수는 중괄호로 구분되는 지역내에서만 유효한 변수들이다. 따라서 지역 변수와 매개 변수는 __선언되는 순간에 스택에 할당되었다가 자신이 할당된 영역을 벗어나면 소멸된다.__  
</br>

- 그 밖에도 _리턴 값 연산에 사용되는 임시 값_ 등이 저장된다.

## 힙 영역

- __`힙 영역`(Heap area)은 `인스턴스`(instance)가 저장되는 공간이다.__  
</br>

- new 키워드로 생성된 인스턴스와 배열이 저장된다. 이 때 메소드 영역에 저장된 클래스만 인스턴스를 생성할 수 있다.  
</br>

```java
public static void simpleMethod() {
    String str1 = new String("My String");
    String str2 = new String("Your String");
}
```

- 위 코드에서 str1과 str2는 `지역 변수`이자 참조 변수이다. 따라서 이 둘은 `스택 영역`에 할당된다.  
</br>

- 그러나 String `인스턴스`들은 무조건 `힙 영역`에 할당된다.  
</br>

- __따라서 스택 영역의 참조 변수 str1, str2가 각각 힙 영역의 인스턴스 "My String", "Your String"을 참조한다고 말할 수 있다.__  
</br>

- 인스턴스를 특별히 스택이 아닌 힙에 할당하는 이유는 __인스턴스의 소멸 시점과 소멸 방법이 지역 변수와 다르기 때문이다.__ 그렇다면 이렇게 힙 영역에 생성된 인스턴스들은 언제 어떻게 소멸될까?

## 가비지 컬렉션

- 힙 영역에 존재하는 인스턴스의 소멸을 결정하는 것은 `JVM`의 역할이다.

```java
str1 = null;
str2 = null;
```

- 이제 "My String"과 "Your String"이라는 두 String 인스턴스는 어떤 참조 변수도 참조하지 않는 상태이다.   
</br>

- __이와 같은 상태의 인스턴스는 존재할 이유가 없으며 `소멸의 대상`이 된다. (하지만 즉시 소멸되는 것은 아니다.)__  
</br>

- __이러한 방식을 `가비지 컬렉션`(Garbage Collection)이라 부른다.__

## 마무리

자바 메모리 영역(Runtime Data Area)에서
1. `메소드 영역`은 메소드 정보, 필드 정보, static 변수, final class 변수 등이 저장되는 공간이다.
2. `스택 영역`은 지역 변수, 매개 변수 등이 저장되는 공간이다.
3. `힙 영역`은 인스턴스가 저장되는 공간이며, `가비지 컬렉션`이 실행되는 공간이다.